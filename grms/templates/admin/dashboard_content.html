<div class="grms-dashboard">
  <div class="grms-hero">
    <p class="hero-kicker">Gravel Road Management System</p>
    <h1 class="dash-title">GRMS Professional Dashboard</h1>
    <p class="dash-subtitle">Analytics overview and quick insights for gravel road management.</p>
  </div>

  <div class="kpi-row">
    <div class="kpi-card">
      <div class="kpi-label">Total Roads</div>
      <div class="kpi-value">{{ total_roads }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Sections</div>
      <div class="kpi-value">{{ total_sections }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Segments</div>
      <div class="kpi-value">{{ total_segments }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Planned Interventions</div>
      <div class="kpi-value">{{ planned_interventions }}</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-label">Latest Traffic Year</div>
      <div class="kpi-value">{{ latest_traffic_year|default:"–" }}</div>
    </div>
  </div>

  <div class="panel-row">
    <div class="panel">
      <div class="panel-heading">
        <div>
          <h2>Surface Type Distribution</h2>
          <p class="panel-subtitle">Live mix across paved, gravel, and earth roads.</p>
        </div>
      </div>
      <canvas id="surfaceChart"></canvas>
    </div>

    <div class="panel">
      <div class="panel-heading">
        <div>
          <h2>Traffic Trend (ADT)</h2>
          <p class="panel-subtitle">Annual average daily traffic across recorded surveys.</p>
        </div>
      </div>
      <canvas id="trafficChart"></canvas>
    </div>
  </div>

  <div class="panel panel-map">
    <div class="panel-heading">
      <div>
        <h2>Road Network Overview</h2>
        <p class="panel-subtitle">Mapped road start points for quick spatial awareness.</p>
      </div>
    </div>
    <div id="roadMap"></div>
  </div>

  <div class="panel insight-row">
    <article class="insight-card">
      <header class="panel-heading">
        <div>
          <h2>Network analysis</h2>
          <p class="panel-subtitle">Auto-generated insights from the latest inventory and traffic data.</p>
        </div>
      </header>
      <ul class="insight-list">
        <li>
          <strong>Surface mix:</strong>
          {{ asphalt_count }} paved/asphalt,
          {{ gravel_count }} gravel,
          {{ dirt_count }} earth.
        </li>
        <li>
          <strong>Traffic coverage:</strong>
          {% if latest_traffic_year %}
            Latest ADT summary in {{ latest_traffic_year }}; {{ grms_data.traffic_values|length|default:0 }} year{{ grms_data.traffic_values|length|default:0|pluralize }} profiled.
          {% else %}
            No traffic summaries yet—add a survey to unlock ADT trends.
          {% endif %}
        </li>
        <li>
          <strong>Geospatial readiness:</strong>
          {{ grms_data.road_locations|length|default:0 }} roads have mapped start coordinates (of {{ total_roads }} total).
        </li>
      </ul>
    </article>

    <article class="insight-card suggestion-card">
      <header class="panel-heading">
        <div>
          <h2>Professional suggestions</h2>
          <p class="panel-subtitle">Practical next steps to keep data decision-ready.</p>
        </div>
      </header>
      <ul class="insight-list">
        <li>Prioritise maintenance plans for the busiest corridors first to capture near-term risk reduction.</li>
        <li>Capture coordinates for remaining roads to enable full network mapping and routing analytics.</li>
        <li>Refresh traffic counts annually for top-growth routes to validate prioritisation inputs.</li>
      </ul>
    </article>
  </div>

  <section class="section-browser">
    <div class="section-browser__header">
      <h2>Browse data</h2>
      <p class="section-browser__hint">Jump into any part of the inventory, surveys, or reference data.</p>
    </div>
    <div class="section-grid">
      {% for section in sections %}
        <article class="section-card">
          <header class="section-card__header">
            <h3>{{ section.title }}</h3>
            <span class="section-card__meta">{{ section.models|length }} item{{ section.models|length|pluralize }}</span>
          </header>
          <ul class="section-card__links">
            {% for model in section.models %}
              <li><a href="{{ model.admin_url }}">{{ model.name }}</a></li>
            {% endfor %}
          </ul>
        </article>
      {% empty %}
        {# Fallback to the stock app list if grouping is unavailable #}
        {% include "admin/app_list.html" with app_list=app_list show_changelinks=True %}
      {% endfor %}
    </div>
  </section>
</div>

{{ grms_data|json_script:"grms-data" }}
