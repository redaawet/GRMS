{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@2.0.0-alpha.1/dist/leaflet.css" />
<style>
.dashboard-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1.5rem 0 2rem;
}
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}
.kpi-card {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1rem 1.25rem;
    box-shadow: 0 8px 20px -10px rgba(0,0,0,0.12);
}
.panel {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1.5rem;
}
.chart-container {
    height: 260px;
}
.menu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 1rem;
}
.menu-group {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 1rem;
}
</style>
{% endblock %}

{% block extrahead %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet@2.0.0-alpha.1/dist/leaflet.js"></script>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">

    <h1>Gravel Road Management Dashboard</h1>
    <p>Key metrics, traffic trends, and quick links to manage GRMS data.</p>

    <div class="kpi-grid">
        <div class="kpi-card"><strong>Total Roads</strong><br>{{ total_roads }}</div>
        <div class="kpi-card"><strong>Road Sections</strong><br>{{ total_sections }}</div>
        <div class="kpi-card"><strong>Road Segments</strong><br>{{ total_segments }}</div>
        <div class="kpi-card"><strong>Planned Interventions</strong><br>{{ planned_interventions }}</div>
        <div class="kpi-card"><strong>Latest Traffic Year</strong><br>{{ latest_traffic_year }}</div>
    </div>

    <div class="panel">
        <h2>Surface Type Distribution</h2>
        <div class="chart-container">
            <canvas id="surfaceChart"></canvas>
        </div>
    </div>

    <div class="panel">
        <h2>Traffic Trend (ADT)</h2>
        <div class="chart-container">
            <canvas id="trafficChart"></canvas>
        </div>
    </div>

    <div class="panel">
        <h2>Road Network Map</h2>
        <div id="road-map" style="width:100%; height:320px;"></div>
    </div>

    <div class="menu-grid">
        {% for group, items in menu_groups.items %}
        <div class="menu-group">
            <h3>{{ group }}</h3>
            <ul>
                {% for item in items %}
                    <li><a href="{{ item.url }}">{{ item.label }}</a></li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
    </div>

</div>

<script>
new Chart(document.getElementById('surfaceChart'), {
    type: 'pie',
    data: {
        labels: ["Asphalt", "Gravel", "Dirt"],
        datasets: [{
            data: [{{ asphalt_count }}, {{ gravel_count }}, {{ dirt_count }}],
            backgroundColor: ['#3b82f6','#10b981','#f59e0b']
        }]
    }
});
</script>

{% endblock %}
