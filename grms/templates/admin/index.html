{% extends "admin/base_site.html" %}
{% load static %}

{% block bodyclass %}grms-dashboard-page {{ block.super }}{% endblock %}

{% block grms_main_content %}
<div class="grms-dashboard">

    <div class="grms-hero">
        <p class="hero-kicker">Gravel Road Management System</p>
        <h1 class="dash-title">GRMS Professional Dashboard</h1>
        <p class="dash-subtitle">Analytics overview and quick insights for gravel road management.</p>
    </div>

    <div class="kpi-row">
        <div class="kpi-card">
            <div class="kpi-label">Total Roads</div>
            <div class="kpi-value">{{ total_roads }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Sections</div>
            <div class="kpi-value">{{ total_sections }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Segments</div>
            <div class="kpi-value">{{ total_segments }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Planned Interventions</div>
            <div class="kpi-value">{{ planned_interventions }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Latest Traffic Year</div>
            <div class="kpi-value">{{ latest_traffic_year|default:"â€“" }}</div>
        </div>
    </div>

    <div class="panel-row">
        <div class="panel">
            <h2>Surface Type Distribution</h2>
            <canvas id="surfaceChart"></canvas>
        </div>

        <div class="panel">
            <h2>Traffic Trend (ADT)</h2>
            <canvas id="trafficChart"></canvas>
        </div>
    </div>

    <div class="panel">
        <h2>Road Network Overview</h2>
        <div id="roadMap"></div>
    </div>

    <section class="section-browser">
        <div class="section-browser__header">
            <h2>Browse data</h2>
            <p class="section-browser__hint">Jump into any part of the inventory, surveys, or reference data.</p>
        </div>
        <div class="section-grid">
            {% for section in sections %}
                <article class="section-card">
                    <header class="section-card__header">
                        <h3>{{ section.title }}</h3>
                        <span class="section-card__meta">{{ section.models|length }} item{{ section.models|length|pluralize }}</span>
                    </header>
                    <ul class="section-card__links">
                        {% for model in section.models %}
                            <li><a href="{{ model.admin_url }}">{{ model.name }}</a></li>
                        {% endfor %}
                    </ul>
                </article>
            {% empty %}
                {# Fallback to the stock app list if grouping is unavailable #}
                {% include "admin/app_list.html" with app_list=app_list show_changelinks=True %}
            {% endfor %}
        </div>
    </section>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
{{ grms_data|json_script:"grms-data" }}
<script src="{% static 'grms/dashboard.js' %}"></script>

{% endblock %}
