{% extends "admin/base_site.html" %}
{% load static %}

{% block bodyclass %}grms-dashboard-page {{ block.super }}{% endblock %}

{% block content %}
<div class="grms-dashboard">

    <div class="grms-hero">
        <p class="hero-kicker">Gravel Road Management System</p>
        <h1 class="dash-title">GRMS Professional Dashboard</h1>
        <p class="dash-subtitle">Analytics overview and quick insights for gravel road management.</p>
    </div>

    <div class="kpi-row">
        <div class="kpi-card">
            <div class="kpi-label">Total Roads</div>
            <div class="kpi-value">{{ total_roads }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Sections</div>
            <div class="kpi-value">{{ total_sections }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Segments</div>
            <div class="kpi-value">{{ total_segments }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Planned Interventions</div>
            <div class="kpi-value">{{ planned_interventions }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Latest Traffic Year</div>
            <div class="kpi-value">{{ latest_traffic_year|default:"–" }}</div>
        </div>
    </div>

    <div class="panel-row">
        <div class="panel">
            <h2>Surface Type Distribution</h2>
            <canvas id="surfaceChart"></canvas>
        </div>

        <div class="panel">
            <h2>Traffic Trend (ADT)</h2>
            <canvas id="trafficChart"></canvas>
        </div>
    </div>

    <div class="panel">
        <h2>Road Network Overview</h2>
        <div id="roadMap"></div>
    </div>

    <div class="panel admin-menu-panel">
        <div class="panel-heading">
            <div>
                <h2>Admin menu</h2>
                <p class="panel-subtitle">Jump to the tools you use most, grouped by workflow.</p>
            </div>
        </div>

        <div class="menu-grid">
            {% for group, items in menu_groups.items %}
                <div class="menu-group-card">
                    <div class="menu-group-header">
                        <h3>{{ group }}</h3>
                        <span class="menu-count">{{ items|length }}</span>
                    </div>
                    <ul class="menu-links">
                        {% for item in items %}
                            <li>
                                <a href="{{ item.url }}" class="menu-link {{ item.active|yesno:'is-active,' }}">
                                    <span class="menu-link-label">{{ item.label }}</span>
                                    <span class="menu-link-arrow">→</span>
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% empty %}
                <p class="empty-menu">No admin sections available.</p>
            {% endfor %}
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
{{ grms_data|json_script:"grms-data" }}
<script src="{% static 'grms/dashboard.js' %}"></script>

{% endblock %}
