{% extends "admin/base_site.html" %}
{% load static %}

{% block bodyclass %}grms-dashboard-page {{ block.super }}{% endblock %}

{% block grms_main_content %}
<div class="grms-dashboard">
    <header class="grms-hero">
        <p class="hero-kicker">Gravel Road Management System</p>
        <h1 class="dash-title">GRMS Dashboard</h1>
        <p class="dash-subtitle">Quick analytics and shortcuts for the admin team.</p>
    </header>

    <section class="kpi-row" aria-label="Key performance indicators">
        <article class="kpi-card">
            <p class="kpi-label">Total Roads</p>
            <p class="kpi-value">{{ total_roads }}</p>
        </article>
        <article class="kpi-card">
            <p class="kpi-label">Sections</p>
            <p class="kpi-value">{{ total_sections }}</p>
        </article>
        <article class="kpi-card">
            <p class="kpi-label">Segments</p>
            <p class="kpi-value">{{ total_segments }}</p>
        </article>
        <article class="kpi-card">
            <p class="kpi-label">Planned Interventions</p>
            <p class="kpi-value">{{ planned_interventions }}</p>
        </article>
        <article class="kpi-card">
            <p class="kpi-label">Latest Traffic Year</p>
            <p class="kpi-value">{{ latest_traffic_year|default:"â€“" }}</p>
        </article>
    </section>

    <section class="panel-row" aria-label="Charts">
        <article class="panel">
            <div class="panel-heading">
                <h2>Surface Type Distribution</h2>
                <p class="panel-subtitle">Share of asphalt, gravel, and dirt surfaces</p>
            </div>
            <canvas id="surfaceChart" aria-label="Surface distribution chart"></canvas>
        </article>

        <article class="panel">
            <div class="panel-heading">
                <h2>Traffic Trend (ADT)</h2>
                <p class="panel-subtitle">Recent average daily traffic readings</p>
            </div>
            <canvas id="trafficChart" aria-label="Traffic trend chart"></canvas>
        </article>
    </section>

    <section class="panel">
        <div class="panel-heading">
            <h2>Road Network Overview</h2>
            <p class="panel-subtitle">Mapped road locations from the latest data</p>
        </div>
        <div id="roadMap" aria-label="Road map"></div>
    </section>

    {% if sections %}
    <section class="panel">
        <div class="panel-heading">
            <h2>Admin shortcuts</h2>
            <p class="panel-subtitle">Manage grouped models without leaving the dashboard.</p>
        </div>
        <div class="section-grid">
            {% for section in sections %}
            <article class="section-card">
                <div class="section-card__header">
                    <h3>{{ section.title }}</h3>
                    <p class="section-card__hint">{{ section.models|length }} models</p>
                </div>
                <ul class="section-card__links">
                    {% for model in section.models %}
                        <li>
                            <a href="{{ model.admin_url }}">{{ model.name }}</a>
                            {% if model.add_url %}
                            <a class="section-card__add" href="{{ model.add_url }}">Add</a>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>

{{ grms_data|json_script:"grms-data" }}
{% endblock %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="{% static 'grms/dashboard.js' %}"></script>
{% endblock %}
