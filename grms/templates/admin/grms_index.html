{% extends "admin/custom_base_site.html" %}
{% load i18n %}

{% block bodyclass %}model-index {{ block.super }}{% endblock %}

{% block content %}
<div id="content-main">
  {% if sections or app_list %}
    <div class="dashboard">
      <div class="dashboard-filter">
        <label class="visually-hidden" for="dashboard-filter-input">{% trans 'Filter models' %}</label>
        <input
          id="dashboard-filter-input"
          type="search"
          placeholder="{% trans 'Filter models' %}"
          aria-label="{% trans 'Filter models' %}"
        />
      </div>
      <p class="dashboard-summary">
        {% blocktrans %}This grouped dashboard lists every model in the Gravel Road Management System so you can manage more than thirty data sets without scrolling through the default app table. Use the filter above to jump directly to a model.{% endblocktrans %}
      </p>
      {% if sections %}
        {% for section in sections %}
          <div class="app-section module" data-section>
            <h2>{{ section.title }}</h2>
            <ul class="model-list">
              {% for model in section.models %}
                <li class="model-{{ model.object_name|lower }}" data-model>
                  {% if model.admin_url %}
                    <a href="{{ model.admin_url }}">{{ model.name }}</a>
                  {% else %}
                    {{ model.name }}
                  {% endif %}
                  <span class="model-actions">
                    {% if model.add_url and not model.view_only %}
                      <a href="{{ model.add_url }}" class="addlink">{% trans "Add" %}</a>
                    {% endif %}
                    {% if model.admin_url %}
                      <a href="{{ model.admin_url }}" class="changelink">{% trans "Change" %}</a>
                    {% endif %}
                  </span>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endfor %}
      {% else %}
        {% for app in app_list %}
          <div class="app-section module" data-section>
            <h2>{{ app.name }}</h2>
            <ul class="model-list">
              {% for model in app.models %}
                <li class="model-{{ model.object_name|lower }}" data-model>
                  {% if model.admin_url %}
                    <a href="{{ model.admin_url }}">{{ model.name }}</a>
                  {% else %}
                    {{ model.name }}
                  {% endif %}
                  <span class="model-actions">
                    {% if model.add_url and not model.view_only %}
                      <a href="{{ model.add_url }}" class="addlink">{% trans "Add" %}</a>
                    {% endif %}
                    {% if model.admin_url %}
                      <a href="{{ model.admin_url }}" class="changelink">{% trans "Change" %}</a>
                    {% endif %}
                  </span>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endfor %}
      {% endif %}
      <p class="no-matches" id="dashboard-no-matches" hidden>
        {% trans "No models match that filter. Try a different keyword." %}
      </p>
    </div>
  {% else %}
    <p class="empty-dashboard">
      {% trans "No models are registered with this admin site yet." %}
    </p>
  {% endif %}
</div>
{% endblock %}

{% block extrastyle %}
    {{ block.super }}
    <style>
      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
        gap: 1rem;
      }

      .dashboard-filter {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 1rem;
        grid-column: 1 / -1;
      }

      #dashboard-filter-input {
        min-width: 18rem;
        max-width: 24rem;
        padding: 0.35rem 0.5rem;
      }

      .dashboard-summary {
        margin-top: 0;
        margin-bottom: 1.5rem;
        color: var(--body-quiet-color);
        font-size: 0.95rem;
      }

      .no-matches {
        margin-top: 1.5rem;
        font-style: italic;
        color: var(--body-quiet-color);
      }

      .empty-dashboard {
        color: var(--body-quiet-color);
      }

      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
    </style>
{% endblock %}

{% block extrahead %}
  {{ block.super }}
  <script>
    window.addEventListener("DOMContentLoaded", function () {
      var input = document.getElementById("dashboard-filter-input");
      var noMatch = document.getElementById("dashboard-no-matches");
      if (!input) {
        return;
      }
      var sections = Array.prototype.slice.call(
        document.querySelectorAll("#content-main .app-section")
      );
      input.addEventListener("input", function (event) {
        var term = event.target.value.trim().toLowerCase();
        var visibleSections = 0;
        sections.forEach(function (section) {
          var items = Array.prototype.slice.call(
            section.querySelectorAll('[data-model]')
          );
          var visibleCount = 0;
          items.forEach(function (item) {
            var match = !term || item.textContent.toLowerCase().indexOf(term) !== -1;
            item.style.display = match ? "" : "none";
            if (match) {
              visibleCount += 1;
            }
          });
          var showSection = visibleCount > 0;
          section.style.display = showSection ? "" : "none";
          if (showSection) {
            visibleSections += 1;
          }
        });
        if (noMatch) {
          noMatch.hidden = visibleSections !== 0;
        }
      });
    });
  </script>
{% endblock %}

  {% block sidebar %}{% endblock %}
