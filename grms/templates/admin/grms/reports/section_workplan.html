{% extends "admin/base_site.html" %}
{% load humanize report_tags %}

{% block content %}
<div class="section-workplan-report">
  <div class="page-header">
    <h1>Section Annual Workplan (Table 25)</h1>
    <form method="get" class="report-filter-form">
      <label for="fiscal_year">Fiscal year</label>
      <input type="number" name="fiscal_year" id="fiscal_year" value="{{ fiscal_year }}" required />
      <label for="road">Road</label>
      <select name="road" id="road">
        <option value="">-- Select road --</option>
        {% for road in road_choices %}
          <option value="{{ road.id }}" {% if road.id|stringformat:"s" == selected_road_id %}selected{% endif %}>{{ road }}</option>
        {% endfor %}
      </select>
      <button type="submit" class="button">Generate</button>
      {% if rows %}
        <a class="button" href="{{ csv_export_url }}">Export CSV</a>
      {% endif %}
    </form>
  </div>

  {% if rows %}
    <div class="report-header">
      <p><strong>Road class:</strong> {{ header_context.road_class }}</p>
      <p><strong>Road name:</strong> {{ header_context.road_name }}</p>
      <p><strong>Rank:</strong> {{ header_context.rank_no }}</p>
    </div>

    <div class="module">
      <table class="admin-table">
        <thead>
          <tr>
            <th>Rd sec no</th>
            <th class="numeric">Start km</th>
            <th class="numeric">End km</th>
            <th class="numeric">Length (km)</th>
            <th>Surface type</th>
            <th>Surface cond</th>
            <th class="numeric">RM</th>
            <th class="numeric">PM</th>
            <th class="numeric">Rehab</th>
            <th class="numeric">Road B-neck</th>
            <th class="numeric">Struct B-neck</th>
            <th class="numeric">Year cost</th>
          </tr>
        </thead>
        <tbody>
          {% for row in rows %}
            <tr>
              <td>{{ row.rd_sec_no }}</td>
              <td class="numeric">{{ row.start_km|floatformat:3 }}</td>
              <td class="numeric">{{ row.end_km|floatformat:3 }}</td>
              <td class="numeric">{{ row.length_km|floatformat:3 }}</td>
              <td>{{ row.surface_type }}</td>
              <td>{{ row.surface_cond }}</td>
              <td class="numeric">{{ row.rm_cost|floatformat:2 }}</td>
              <td class="numeric">{{ row.pm_cost|floatformat:2 }}</td>
              <td class="numeric">{{ row.rehab_cost|floatformat:2 }}</td>
              <td class="numeric">{{ row.road_bneck_cost|floatformat:2 }}</td>
              <td class="numeric">{{ row.structure_bneck_cost|floatformat:2 }}</td>
              <td class="numeric">{{ row.year_cost|floatformat:2 }}</td>
            </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="3">Totals</th>
            <th class="numeric">{{ totals.length_km|floatformat:3 }}</th>
            <th colspan="2"></th>
            <th class="numeric">{{ totals.rm_cost|floatformat:2 }}</th>
            <th class="numeric">{{ totals.pm_cost|floatformat:2 }}</th>
            <th class="numeric">{{ totals.rehab_cost|floatformat:2 }}</th>
            <th class="numeric">{{ totals.road_bneck_cost|floatformat:2 }}</th>
            <th class="numeric">{{ totals.structure_bneck_cost|floatformat:2 }}</th>
            <th class="numeric">{{ totals.year_cost|floatformat:2 }}</th>
          </tr>
        </tfoot>
      </table>
    </div>
  {% else %}
    <p>No rows to display. Please pick a fiscal year and road.</p>
  {% endif %}
</div>
{% endblock %}
