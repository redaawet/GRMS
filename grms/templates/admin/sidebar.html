{% load static admin_urls sidebar_tags %}

<aside id="grms-sidebar" class="sidebar grms-sidebar" aria-label="GRMS admin sidebar">
  <style>
    #grms-sidebar {
      position: fixed;
      top: var(--grms-header-height, 60px);
      left: 0;
      width: 240px;
      height: calc(100vh - var(--grms-header-height, 60px));
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 8px;
      box-sizing: border-box;
      overflow: hidden;
    }

    #grms-sidebar .sidebar-nav {
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow-y: auto;
    }

    #grms-sidebar .sg-content {
      display: block;
    }

    #grms-sidebar .ss-list {
      display: flex;
      flex-direction: column;
      gap: 2px;
      padding: 2px 0 8px;
    }

    /* Keep main content clear of the fixed header */
    body.grms-admin #container,
    body.grms-admin .main,
    body.grms-admin #content,
    body.grms-admin .content {
      padding-top: var(--grms-header-height, 60px);
    }
  </style>

  <div class="sidebar-header">
    <button id="sidebar-toggle" class="sidebar-toggle" type="button" aria-label="Collapse sidebar">▸</button>
    <input id="sidebar-search" class="sidebar-search" type="search" placeholder="Search menu…" aria-label="Search menu"/>
  </div>

  <nav class="sidebar-nav" aria-label="GRMS admin navigation">
    {% for group_title, group_items in MENU_GROUPS.items %}

      <details class="sidebar-group" data-group="{{ group_title|slugify }}">
        <summary class="sg-header">
          <span class="sg-title">{{ group_title }}</span>
          <span class="sg-arrow" aria-hidden="true">▸</span>
        </summary>

        <div class="sg-content">
          {# group_items can be list OR dict-of-subgroups #}
          {% if group_items.items %}
            {% for subgroup_title, subgroup_items in group_items.items %}
              <details class="sidebar-subgroup">
                <summary class="ss-header">
                  <span class="ss-title">{{ subgroup_title }}</span>
                  <span class="ss-arrow" aria-hidden="true">▸</span>
                </summary>
                <div class="ss-list">
                  {% for model_name, display_name in subgroup_items %}
                    {% resolve_model model_name as model %}
                    {% if model %}
                      <a class="ss-link menu-item" href="{% url model|admin_urlname:'changelist' %}">
                        {{ display_name }}
                      </a>
                    {% endif %}
                  {% endfor %}
                </div>
              </details>
            {% endfor %}
          {% else %}
            {% for model_name, display_name in group_items %}
              {% resolve_model model_name as model %}
              {% if model %}
                <a class="ss-link menu-item" href="{% url model|admin_urlname:'changelist' %}">
                  {{ display_name }}
                </a>
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>
      </details>

    {% endfor %}
  </nav>
</aside>
